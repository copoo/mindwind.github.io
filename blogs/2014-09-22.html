<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
	  	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	  	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	  	<link rel="stylesheet" href="/css/blog.css">
		<script type="text/javascript" src="/js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="/js/blog.js"></script>
		<script type="text/javascript" src="/js/ga.js"></script>
		
		<title>深入浅出 RPC - 深入篇</title>
	</head>

	<body>
		<div id="header" class="header"></div>
		
		<div id="center" class="center">
			<div id="content" class="content">
<span class="date">2014-09-22</span>
<h1>深入浅出 RPC - 深入篇</h1>
<img alt="" src="/blogs/2014-09-22.png" width="690">
<p>《深入篇》我们主要围绕 RPC 的功能目标和实现考量去展开，一个基本的 RPC 框架应该提供什么功能，满足什么要求以及如何去实现它？</p>

<h2>RPC 功能目标</h2>
<p>
<b>RPC 的主要功能目标是让构建分布式计算（应用）更容易，在提供强大的远程调用能力时不损失本地调用的语义简洁性。</b>
为实现该目标，RPC 框架需提供一种透明调用机制让使用者不必显式的区分本地调用和远程调用，在前文《浅出篇》中给出了一种实现结构，基于 stub 的结构来实现。
下一节我们将具体细化 stub 结构的实现。
</p>

<h2>RPC 结构拆解</h2>
<p>
《浅出篇》给出了一个比较粗粒度的 RPC 实现概念结构，这里我们进一步细化它应该由哪些组件构成，如下图所示。
<a href="2014-09-22-1.svg" target="_blank"><img src="2014-09-22-1.svg" width="690"/></a><br>
</p>
<p>
RPC 服务方通过 <code>RpcServer</code> 去发布（export）远程接口方法，而客户方通过 <code>RpcClient</code> 去引入（import）远程接口方法。
客户方像调用本地方法一样去调用远程接口方法，RPC 框架提供接口的代理实现，实际的调用将委托给代理 <code>RpcProxy</code> 。
代理封装调用信息并将调用转交给 <code>RpcInvoker</code> 去实际执行。
在客户端的 <code>RpcInvoker</code> 使用 <code>RpcProtocol</code> 执行协议编码（encode），并通过连接器 <code>RpcConnector</code> 去维持与服务端的通道 <code>RpcChannel</code>，
通过通道去传输数据。
</p>
<p>
RPC 服务端接收器 <code>RpcAcceptor</code> 接收客户端的调用请求，同样使用<code>RpcProtocol</code> 执行协议解码（decode）。
解码后的调用信息传递给 <code>RpcProcessor</code> 去控制处理调用过程，最后再委托调用给 <code>RpcInvoker</code> 去实际执行并返回调用结果。
</p>

<h2>RPC 组件职责</h2>
<p>
上面我们进一步拆解了 RPC 实现结构的各个组件组成部分，下面我们详细说明下每个组件的职责划分。
</p>
<pre><code>
<b>RpcClient</b>
负责引入（import）远程接口的代理实现
<b>RpcServer</b>
负责导出（export）远程接口
<b>RpcProxy</b>
远程接口的代理实现
<b>RpcInvoker</b>
客户方实现：负责编码调用信息和发送调用到服务方并等待调用结果返回
服务方实现：负责调用服务端接口的具体实现并返回调用结果
<b>RpcProtocol</b>
负责协议编/解码
<b>RpcConnector</b>
负责维持客户方和服务方的连接通道和发送数据到服务方
<b>RpcAcceptor</b>
负责接收客户方请求并返回请求结果
<b>RpcProcessor</b>
负责在服务方控制调用过程，包括管理调用线程池、超时时间等
<b>RpcChannel</b>
数据传输通道
</code></pre>
			</div>
			<div id="aside"></div>
		</div>
		
		<div id="footer" class="footer"></div>
	</body>
</html>

