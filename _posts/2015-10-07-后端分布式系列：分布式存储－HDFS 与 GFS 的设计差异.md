---
layout    : post
title     : 后端分布式系列：分布式存储－HDFS 与 GFS 的设计差异
date      : 2015-10-07
author    : mindwind
categories: blog
tags      : 分布式存储 HDFS GFS
image     : /assets/article_images/2015-10-07.jpg
---


前面关于 HDFS 的一系列文章介绍它的整体架构和一些关键部件的设计实现要点。
我们知道 HDFS 最早是根据 GFS（Google File System）的论文概念模型来设计实现的。
然后呢，我就去把 GFS 的原始论文找出来仔细看了遍，GFS 的整体架构图如下：  
![](/assets/article_images/2015-10-07-1.png)

HDFS 参照了它所以大部分架构设计概念是类似的，比如 HDFS NameNode 相当于 GFS Master，HDFS DataNode 相当于 GFS ChunkServer。
但还有些细节不同的地方。所以本文主要分析下不同的地方。


## 写入模型
HDFS 在考虑写入模型时做了一个简化，就是同一时刻只允许一个写入者或追加者。
在这个模型下同一个文件同一个时刻只允许一个客户端写入或追加。
而 GFS 则允许同一时刻多个客户端并发写入或追加同一文件。

允许并发写入带来了更复杂的一致性问题。
多个客户端并发写入，多个客户端之间的顺序是无法保证的，同一个客户端连续追加成功的多个记录也可能被打断。
这意味着一个客户端在连续写入文件数据时，它的数据最终在文件种的分布可能是不连续的。

所谓一致性就是，对同一个文件，所有的客户端看到的数据是一致的，不管它们是从哪个副本读取的。
如果允许多个客户端同时写一个文件，怎么保证写入数据在多个副本间一致？
我们前面讲 HDFS 时它只允许一个写入者按流水线方式写入多个副本，写入顺序一致，写入完成后数据将保持最终一致。
而对多个客户端而言，就必须让所有同时写入的客户端按同一种流水线方式去写入，才可能保证写入顺序一致。
这个写入流程我们下一节详细分析。


## 写入流程






## 总结
Client 在 HDFS 的三个主要部件中相对简单，在设计实现时更多考虑易用性、容错和性能。
至此，对 HDFS 的三个主要部件 NameNode、DataNode 和 Client 的设计实现要点进行了讲述，
后续会以主题文章对其中一些关键的技术点做进一步剖析。


## 参考
[1] Hadoop Documentation. [HDFS Architecture](http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html).  
[2] Robert Chansler, Hairong Kuang, Sanjay Radia, Konstantin Shvachko, and Suresh Srinivas. [The Hadoop Distributed File System](http://www.aosabook.org/en/hdfs.html)  
[3] Tom White. [Hadoop: The Definitive Guide](http://book.douban.com/subject/10464777/). O'Reilly Media(2012-05), pp 94-96
