---
layout    : post
title     : 后端分布式系列：分布式存储-HDFS 异常处理与恢复
date      : 2015-09-01
author    : mindwind
categories: blog
tags      : 分布式存储 HDFS 异常 恢复
image     : /assets/article_images/2015-09-01.jpg
---


在前面的文章 [《HDFS DataNode 设计实现解析》]({% post_url 2015-08-20-后端分布式系列：分布式存储－HDFS Datanode 设计实现解析 %})
中我们对文件操作进行了描述，但并未展开讲述其中涉及的异常错误处理与恢复机制。
本文将深入探讨 HDFS 文件操作涉及的错误处理与恢复过程。


## 读异常与恢复
读文件可能发生的异常有两种：

  1. 读取过程中 DataNode 挂了
  2. 读取到的文件数据损坏

HDFS 的文件块多副本分散存储机制保障了数据存储的可靠性，
对于第一种情况 DataNode 挂了只需要失败转移到其他副本所在的 DataNode 继续读取，
而对于第二种情况读取到的文件数据块若校验失败可认定为损坏，依然可以转移到读取其他完好的副本，
并向 NameNode 汇报文件 block 损坏，损坏的文件 block 的后续处理为 NameNode 通知 DataNode 删除损坏文件，
并根据完好的副本来复制一份新的文件块副本。

因为读文件不涉及数据的改变，所以处理起来相对简单，恢复机制的透明性和易用性都非常好。


## 写异常与恢复

### Block 和 Replica 的状态变迁


### Lease Recovery


### Block Recovery


### Pipeline Recovery


## 总结



## 参考
[1] Hadoop Documentation. [HDFS Architecture](http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html).
[2] Robert Chansler, Hairong Kuang, Sanjay Radia, Konstantin Shvachko, and Suresh Srinivas. [The Hadoop Distributed File System](http://www.aosabook.org/en/hdfs.html)
[3] Tom White. [Hadoop: The Definitive Guide](http://book.douban.com/subject/10464777/). O'Reilly Media(2012-05), pp 94-96
[4] Yongjun Zhang. [Understanding HDFS Recovery Processes](http://blog.cloudera.com/blog/2015/02/understanding-hdfs-recovery-processes-part-1/)
[5] Hairong Kuang, Konstantin Shvachko, Nicholas Sze, Sanjay Radia,  Robert Chansler , Yahoo! HDFS team  [Design Specification: Append/Hflush/Read Design ](https://issues.apache.org/jira/secure/attachment/12445209/appendDesign3.pdf)
[6] HDFSteam. [Design Specification: HDFS Append and Truncates](https://issues.apache.org/jira/secure/attachment/12370562/Appends.doc)
